# Saudade Blog (Refactored)

> **ä¸€ä¸ªé£æ ¼å¯çˆ±çš„ä¸ªäººä¸»é¢˜åšå®¢ (Rust é‡æ„ç‰ˆ)**

æœ¬ä»“åº“ä¸º **Saudade Blog** çš„å…¨æ ˆä»“åº“ã€‚åç«¯å·²ä½¿ç”¨ **Rust (Axum + SeaORM)** å®Œå…¨é‡æ„ï¼Œå‰ç«¯åŸºäº React 18ã€‚
æœ¬æ–‡æ¡£æä¾›ä»æºç ç¼–è¯‘åˆ°æœ€ç»ˆéƒ¨ç½²çš„å…¨æµç¨‹æŒ‡å—ï¼Œç¡®ä¿æ‚¨èƒ½å¤Ÿç‹¬ç«‹éƒ¨ç½²ã€‚

## ğŸ› ï¸ å‰ç½®è¦æ±‚

åœ¨å¼€å§‹éƒ¨ç½²å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„æœåŠ¡å™¨æˆ–å¼€å‘æœºå·²å®‰è£…ä»¥ä¸‹ç¯å¢ƒï¼š

1.  **Rust Toolchain**: 1.75+ ([Install Rust](https://rustup.rs/))
2.  **Node.js**: 18.0+ ([Install Node](https://nodejs.org/))
3.  **MySQL**: 8.0+
4.  **Nginx**: ä»»æ„ç¨³å®šç‰ˆæœ¬ (ç”¨äºåå‘ä»£ç†)

---

## ğŸ“‚ é¡¹ç›®ç»“æ„æ¦‚è§ˆ

```text
/opt/memory_blog_rust/
|-- Cargo.toml          # [åç«¯] ä¾èµ–é…ç½®
|-- src/                # [åç«¯] æºç 
|-- frontend/           # [å‰ç«¯] é¡¹ç›®æ ¹ç›®å½•
|   |-- package.json    # [å‰ç«¯] ä¾èµ–é…ç½®
|   |-- vite.config.ts  # [å‰ç«¯] æ„å»ºé…ç½®
|   |-- dist/           # [å‰ç«¯] ç¼–è¯‘åçš„é™æ€æ–‡ä»¶ (æ‰§è¡Œ npm run build åç”Ÿæˆ)
|-- uploads/            # [å­˜å‚¨] å›¾ç‰‡ä¸Šä¼ ç›®å½•
|-- .env                # [é…ç½®] å…¨å±€ç¯å¢ƒå˜é‡
```

---

## âš™ï¸ ç¬¬ä¸€æ­¥ï¼šåŸºç¡€é…ç½®

### 1. æ•°æ®åº“åˆå§‹åŒ– (MySQL)

ç™»å½• MySQL å¹¶æ‰§è¡Œï¼š

```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE IF NOT EXISTS memory_blog DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
-- åˆ›å»ºç”¨æˆ·
CREATE USER 'memory_blog'@'%' IDENTIFIED BY 'MemoryBlog_123456';
-- æˆæƒ
GRANT ALL PRIVILEGES ON memory_blog.* TO 'memory_blog'@'%';
FLUSH PRIVILEGES;
```

### 2. ç¯å¢ƒå˜é‡ (.env)

åœ¨é¡¹ç›®æ ¹ç›®å½• `/opt/memory_blog_rust/` ä¸‹åˆ›å»º `.env` æ–‡ä»¶ï¼š

```ini
# Database Connection (æ ¼å¼: mysql://user:password@host/dbname)
DATABASE_URL=mysql://memory_blog:MemoryBlog_123456@localhost/memory_blog

# Logging Level
RUST_LOG=debug

# Server Port (åç«¯ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ 3000)
SERVER_PORT=3000

# JWT / Secrets (å¦‚æœä»£ç ä¸­æœ‰ç”¨åˆ°)
JWT_SECRET=your_jwt_secret_key
```

---

## ğŸ“¦ ç¬¬äºŒæ­¥ï¼šç¼–è¯‘æ„å»º (æ ¸å¿ƒ)

### 1. ç¼–è¯‘å‰ç«¯ (Generate Static Files)

å‰ç«¯åŸºäº Vite æ„å»ºï¼Œç¼–è¯‘åä¼šç”Ÿæˆçº¯é™æ€æ–‡ä»¶ï¼ˆHTML/CSS/JSï¼‰ã€‚

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# å®‰è£…ä¾èµ–
npm install

# æ‰§è¡Œæ„å»º (ç”Ÿäº§æ¨¡å¼)
npm run build

# ---
# æ„å»ºæˆåŠŸåï¼Œå¯ä»¥åœ¨ frontend/dist/ ç›®å½•ä¸‹çœ‹åˆ° index.html å’Œ assets æ–‡ä»¶å¤¹ã€‚
# è¿™ä¸ª dist ç›®å½•å°±æ˜¯æˆ‘ä»¬éœ€è¦éƒ¨ç½²çš„å…¨éƒ¨å‰ç«¯å†…å®¹ã€‚
```

### 2. ç¼–è¯‘åç«¯ (Generate Binary)

åç«¯ç¼–è¯‘ä¸ºå•ä¸€çš„å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€‚

```bash
# å›åˆ°é¡¹ç›®æ ¹ç›®å½•
cd ..

# ç¼–è¯‘ Release ç‰ˆæœ¬ (ä¼˜åŒ–æ€§èƒ½)
cargo build --release

# ---
# ç¼–è¯‘äº§ç‰©ä½äº target/release/memory_blog_rust
# è¯¥äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¸ä»…ä¾èµ– libc (Linux æ ‡å‡†åº“)ã€‚
```

---

## ğŸš€ ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²ä¸Šçº¿ (Deployment)

æˆ‘ä»¬æ¨èä½¿ç”¨ **Nginx** æ‰˜ç®¡å‰ç«¯é™æ€èµ„æºï¼Œå¹¶åå‘ä»£ç† API è¯·æ±‚ç»™ Rust åç«¯ã€‚

### 1. è¿è¡Œåç«¯æœåŠ¡

ä¸ºäº†ä¿è¯åå°è¿è¡Œï¼Œå»ºè®®ä½¿ç”¨ `systemd` æˆ– `supervisor`ï¼Œè¿™é‡Œæ¼”ç¤ºç®€å•çš„ `nohup` æˆ–å‰å°è¿è¡Œï¼š

```bash
# å¯åŠ¨åç«¯ (ç¡®ä¿åœ¨æ ¹ç›®å½•ï¼Œå› ä¸ºéœ€è¦è¯»å– .env)
./target/release/memory_blog_rust

# æµ‹è¯•æ˜¯å¦å¯åŠ¨æˆåŠŸ
curl http://127.0.0.1:3000/api/health # (å‡è®¾æœ‰å¥åº·æ£€æŸ¥æ¥å£)
```

### 2. é…ç½® Nginx

ç¼–è¾‘ Nginx é…ç½®æ–‡ä»¶ (ä¾‹å¦‚ `/etc/nginx/sites-available/blog`)ï¼š

```nginx
server {
    listen 80;
    server_name your_domain.com; # æ›¿æ¢ä¸ºæ‚¨çš„åŸŸå/IP

    # --- å‰ç«¯é…ç½® ---
    # æŒ‡å‘åˆšåˆšç¼–è¯‘ç”Ÿæˆçš„ dist ç›®å½•ç»å¯¹è·¯å¾„
    root /opt/memory_blog_rust/frontend/dist;
    index index.html;

    location / {
        # SPA å•é¡µåº”ç”¨å¿…å¤‡ï¼šæ‰¾ä¸åˆ°æ–‡ä»¶æ—¶å›é€€åˆ° index.html
        try_files $uri $uri/ /index.html;
        expires 1d;
    }

    # --- åç«¯ API ä»£ç† ---
    location /api/ {
        # è½¬å‘è¯·æ±‚åˆ° Rust åç«¯
        proxy_pass http://127.0.0.1:3000;
        
        # å¿…è¦çš„å¤´ä¿¡æ¯
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # --- å¯é€‰ï¼šä¸Šä¼ æ–‡ä»¶ç›®å½• ---
    location /uploads/ {
        alias /opt/memory_blog_rust/uploads/;
        expires 7d;
    }
}
```

### 3. é‡å¯ Nginx

```bash
sudo nginx -t   # æ£€æŸ¥é…ç½®è¯­æ³•
sudo systemctl reload nginx
```

æ­¤æ—¶ï¼Œè®¿é—® `http://your_domain.com` å³å¯çœ‹åˆ°å®Œæ•´è¿è¡Œçš„åšå®¢ã€‚

---

## â“ å¸¸è§é—®é¢˜

**Q: åªæœ‰ index.html ç©ºç™½é¡µé¢ï¼Ÿ**
A: æ£€æŸ¥ Nginx æ—¥å¿—ã€‚é€šå¸¸æ˜¯ `try_files` æ²¡é…ç½®å¥½ï¼Œæˆ–è€… JS æ–‡ä»¶ 404ã€‚ç¡®ä¿ Nginx `root` è·¯å¾„æ­£ç¡®æŒ‡å‘äº† `dist`ã€‚

**Q: æ¥å£æŠ¥ 404 æˆ– 502ï¼Ÿ**
A: æ£€æŸ¥ Rust åç«¯æ˜¯å¦åœ¨è¿è¡Œ (`netstat -tulpn | grep 3000`)ã€‚æ£€æŸ¥ Nginx `proxy_pass` æ˜¯å¦æŒ‡å‘äº†æ­£ç¡®çš„ç«¯å£ã€‚

**Q: ä¸Šä¼ å›¾ç‰‡å¤±è´¥ï¼Ÿ**
A: ç¡®ä¿ `/opt/memory_blog_rust/uploads/` ç›®å½•å­˜åœ¨ä¸”å¯¹è¿è¡Œåç«¯çš„ç”¨æˆ·æœ‰å†™å…¥æƒé™ã€‚

## :heart: é¸£è°¢

- åŸä½œè®¾è®¡: [Memory-Blog](https://github.com/LinMoQC/Memory-Blog)
- ç»´æŠ¤è€…: æ—é™Œé’å·
